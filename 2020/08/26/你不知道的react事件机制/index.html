<!DOCTYPE html><html lang="en-us"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"><title>你不知道的react事件机制 | duuliy</title><meta name="description" content="react16事件机制，浅提，因为网上很多文章了..."><meta name="generator" content="duuliy"><meta name="author" content="duuliy"><meta name="keywords"><meta name="HandheldFriendly" content="True"><meta name="MobileOptimized" content="320"><meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1,user-scalable=0"><link rel="stylesheet" type="text/css" href="/styles/screen.css"><link rel="apple-touch-icon" sizes="57x57" href="/images/logo.png"><link rel="apple-touch-icon" sizes="60x60" href="/images/logo.png"><link rel="apple-touch-icon" sizes="72x72" href="/images/logo.png"><link rel="apple-touch-icon" sizes="76x76" href="/images/logo.png"><link rel="apple-touch-icon" sizes="114x114" href="/images/logo.png"><link rel="apple-touch-icon" sizes="120x120" href="/images/logo.png"><link rel="apple-touch-icon" sizes="144x144" href="/images/logo.png"><link rel="apple-touch-icon" sizes="152x152" href="/images/logo.png"><link rel="apple-touch-icon" sizes="180x180" href="/images/logo.png"><link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16.png"><link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32.png"><link rel="icon" type="image/png" sizes="96x96" href="/images/favicon-96x96.png"><link rel="icon" type="image/png" sizes="128x128" href="/images/favicon-128.png"><link rel="icon" type="image/png" sizes="196x196" href="/images/favicon-196x196.png"><meta name="msapplication-TileColor" content="#FFFFFF"><meta name="msapplication-TileImage" content="logo.png"><meta name="msapplication-square70x70logo" content="logo.png"><meta name="msapplication-square150x150logo" content="logo.png"><meta name="msapplication-wide310x150logo" content="logo.png"><meta name="msapplication-square310x310logo" content="logo.png"><link rel="stylesheet" href="/css/prism.css" type="text/css"></head><body itemscope itemtype="https://schema.org/WebPage"><header itemscope itemtype="https://schema.org/WPHeader"><div class="logo"></div><h1><a href="/" alt="duuliy" title="duuliy" itemprop="headline">duuliy</a></h1><p itemprop="description"></p><nav itemscope itemtype="https://schema.org/SiteNavigationElement"><ul><li itemprop="name"><a href="/ " alt="主页" title="主页" itemprop="url">主页</a></li><li itemprop="name"><a href="/archives" alt="归档" title="归档" itemprop="url">归档</a></li><li itemprop="name"><a href="/about" alt="关于" title="关于" itemprop="url">关于</a></li></ul></nav><footer><div class="container beautiful-jekyll-footer"><div class="row"><div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1"><p class="theme-by text-muted">Theme by
<a target="_blank" rel="noopener" href="https://github.com/mkkhedawat/clexy">clexy-hexo</a></p><p class="copyright text-muted">© duuliy • 2025</p></div></div></div></footer><div class="space"></div></header><main itemscope itemtype="https://schema.org/Blog"><article class="full"><h1 itemprop="headline" class="post-heading">你不知道的react事件机制</h1><span class="post-meta"></span><span class="page-tag-anchor">2020-8-26</span><br><br><h4 id="react16事件机制，浅提，因为网上很多文章了。"><a href="#react16事件机制，浅提，因为网上很多文章了。" class="headerlink" title="react16事件机制，浅提，因为网上很多文章了。"></a>react16事件机制，浅提，因为网上很多文章了。</h4><p>1.原生事件阻止冒泡肯定会组织合成事件的触发，合成事件的阻止冒泡不会影响原生事件。</p>
<p>2.React 将事件全部统一交给 document 来委托处理。</p>
<p>3.onclick={test},test=e=&gt;console.log(e)<br> 这个e是合成的，原生的在e.nativeEvent里面</p>
<p>4.绑定在document 上之后，dispatchEvent 方法统一进行派发（得到事件类型和组件id，在listenerBank里面寻找绑定的回调函数,然后触发）。</p>
<h4 id="与react17的区别（官网也说的很清楚了）"><a href="#与react17的区别（官网也说的很清楚了）" class="headerlink" title="与react17的区别（官网也说的很清楚了）"></a>与react17的区别（官网也说的很清楚了）</h4><p>1.事件：16绑定在document（最顶部）上面，17绑定在调整将顶层事件绑在container上，ReactDOM.render(app， container)；（createPortal创建的modal也是#Modal-root，也会有一层事件监听），能够解决我们遇到的多版本共存问题，对微前端方案是个重大利好。</p>
<p>2.React 17 中终于支持了原生捕获事件的支持， 对齐了浏览器原生标准。<br>同时onScroll 事件不再进行事件冒泡</p>
<p>3.移除时间池</p>
<h4 id="重点来了，如何验证"><a href="#重点来了，如何验证" class="headerlink" title="重点来了，如何验证"></a>重点来了，如何验证</h4><p>1.首先在.html文件<br>a.button上绑定事件,如图<br><img src="/2020/08/26/%E4%BD%A0%E4%B8%8D%E7%9F%A5%E9%81%93%E7%9A%84react%E4%BA%8B%E4%BB%B6%E6%9C%BA%E5%88%B6/WX20210126-233604@2x.png" alt="图片"><br>b.在document上监听addEventListener，如图<br><img src="/2020/08/26/%E4%BD%A0%E4%B8%8D%E7%9F%A5%E9%81%93%E7%9A%84react%E4%BA%8B%E4%BB%B6%E6%9C%BA%E5%88%B6/WX20210126-233624@2x.png" alt="图片"></p>
<p>长这样，没有问题，记住！</p>
<p>2.然后在react16 和react17 上的div上绑定事件</p>
<p><img src="/2020/08/26/%E4%BD%A0%E4%B8%8D%E7%9F%A5%E9%81%93%E7%9A%84react%E4%BA%8B%E4%BB%B6%E6%9C%BA%E5%88%B6/WX20210126-233922@2x.png" alt="图片"><br><img src="/2020/08/26/%E4%BD%A0%E4%B8%8D%E7%9F%A5%E9%81%93%E7%9A%84react%E4%BA%8B%E4%BB%B6%E6%9C%BA%E5%88%B6/WX20210126-233945@2x.png" alt="图片"></p>
<p>16在document，17在root没有问题，但是…<br>奇怪了！为啥li 和button上都有事件呢，不是说react事件都统一委托到root上吗，难道官网有错？<br>是不是跟环境有关，行！我去coderunner上写一个，如图<br><img src="/2020/08/26/%E4%BD%A0%E4%B8%8D%E7%9F%A5%E9%81%93%E7%9A%84react%E4%BA%8B%E4%BB%B6%E6%9C%BA%E5%88%B6/WX20210126-234422@2x.png" alt="图片"><br>真的怪了，也是在dom上… </p>
<p>推断：<br>&emsp;&emsp;但是每个子组件的事件却在同一行，又都叫’uc’,说明绑定的是同一个事件，目的是冒泡传递节点信息，而不是具体绑定的事件！！！</p>
<p>查资料，查查查，1个多小时了，翻墙也找不到为什么？<br>得了，看看源码吧,验证一下推断。</p>
<p>用了ensureListeningTo 做了事件委托，但是这三个为什么不做处理呢？</p>
<pre class=" language-js"><code class="language-js"><span class="token keyword">case</span> TOP_CLOSE<span class="token punctuation">:</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isEventSupported</span><span class="token punctuation">(</span><span class="token function">getRawEventName</span><span class="token punctuation">(</span>dependency<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>
            <span class="token function">trapCapturedEvent</span><span class="token punctuation">(</span>dependency<span class="token punctuation">,</span> mountAt<span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span>
          <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token keyword">case</span> TOP_INVALID<span class="token punctuation">:</span>
        <span class="token keyword">case</span> TOP_SUBMIT<span class="token punctuation">:</span>
        <span class="token keyword">case</span> TOP_RESET<span class="token punctuation">:</span>
          <span class="token comment" spellcheck="true">// We listen to them on the target DOM elements.</span>
          <span class="token comment" spellcheck="true">// Some of them bubble so we don't want them to fire twice.</span>
          <span class="token keyword">break</span><span class="token punctuation">;</span></code></pre>
<p>ensureListeningTo里面：<br>&emsp;&emsp;trapCapturedEvent 表示捕获阶段的事件监听器<br>&emsp;&emsp;trapBubbledEvent 表示冒泡阶段的事件监听器</p>
<p>恍然大悟，<br>原来：事件分为 3 类。分别是 DiscreteEvent（离散事件），UserBlockingEvent（用户阻塞事件），ContinuousEvent（连续事件）。不同类型的事件代表了不同的优先级。<br>但是：事件委托需要区分捕获和冒泡，有些事件由于没有冒泡过程，只能在捕获阶段进行事件委托。eg：scroll ，focus<br>还有：没有进行委托的事件是 Form 事件和 Media 事件，原因是这些事件委托后会触发两次回调函数。</p>
<p>不对不对，依然不能验证推断，也解释不通啊？<br>等等，在线编码打印得事件叫 ’noop‘，有点奇怪，查一下 <a target="_blank" rel="noopener" href="https://developer.aliyun.com/mirror/npm/package/react-props-noop">https://developer.aliyun.com/mirror/npm/package/react-props-noop</a></p>
<p><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/68477600">https://zhuanlan.zhihu.com/p/68477600</a> 尤大大得 vue3.0也在用 ’noop‘<br>出结论了：dom上依然有事件函数，但是函数的noop，什么都不做的函数，用于直接返回参数本身</p>
<p>哈哈，开心！强迫症出结论了 我的推断正确！！！</p>
</article><br><br><span class="next-post"><a href="/2020/05/06/useEffect和心智模型总结/" itemprop="url">上一章 ⇒</a></span><span class="prev-post"><a href="/2020/10/27/webpack4-babel7做react脚手架/" itemprop="url">⇐ 下一章 </a></span><br><br><br></main></body></html>